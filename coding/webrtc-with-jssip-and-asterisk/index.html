<!DOCTYPE html>
<html lang="en">
<head>


	<!-- Facebook Share -->
    <meta property="og:title" content="WebRTC with JsSIP and Asterisk" />
    <meta property="og:description" content="Recently I've been trying to get a web phone up and running, my only real requirement was to use Asterisk. So I decided to go with the following technology stack, JsSIP, Chrome and Asterisk.
" />
    <meta property="og:url" content="//blog.saevon.ca/coding/webrtc-with-jssip-and-asterisk/" />
    <meta property="og:type" content="article" />

	<meta property="og:site_name" content="Saevon's Blog"/>
	<meta property="og:image" content="/static/images/avatar-facebook.jpg" />
	<meta property="og:image:secure_url" content="/static/images/avatar-facebook.jpg" />


	<!-- Styles -->
	<link rel="stylesheet" type="text/css" href="/static/css/bootstrap.min.css">
	<link rel="stylesheet" type="text/css" href="/static/css/bootstrap-theme.min.css">
	<link href="//netdna.bootstrapcdn.com/font-awesome/4.0.3/css/font-awesome.css" rel="stylesheet">

	<link rel="stylesheet" type="text/css" href="/static/css/pygments.css">
	<link rel="stylesheet" type="text/css" href="/static/css/main.css">
	<link rel="stylesheet" type="text/css" href="/static/css/sidenav.css">
	<link rel="stylesheet" type="text/css" href="/static/css/article.css">

    


	<!-- Javascript -->
	<script src="https://code.jquery.com/jquery-2.1.0.min.js"></script>
	<script src="//netdna.bootstrapcdn.com/bootstrap/3.1.1/js/bootstrap.min.js"></script>



		<title>Saevon.ca</title>
		<meta charset="utf-8" />
</head>
<body>
	<div class="container-fluid"><div class="row">
		<!-- Section that does nothing but take up space the sidenav needs to be fixed to -->
		<section class="sidenav-placeholder col-md-3 col-sm-3 col-xs-12"></section>
			<div class="sidenav col-md-3 col-sm-3 col-xs-12">

<div class="sidenav-avatar">
    <hr />
    <a href="/" class="avatar-wrapper perma-link">
        <img src="/static/images/avatar.jpg" class="center avatar img-rounded" />
        <h1 class="site-name">Saevon</h1>
    </a>
    <hr class="nav-small-hide"/>
</div>


<div class="sidenav-menu">
    <div class="nav-link nav-group ">
        <a href="//blog.saevon.ca/">
            <div class="nav-link-title">
                Categories
            </div>
        </a>
        <ul class="nav-group-content">
            <li class="nav-group-item active">
                <a href="//blog.saevon.ca/coding/">
                    Coding
                </a>
            </li>
            <li class="nav-group-item ">
                <a href="//blog.saevon.ca/personal/">
                    Personal
                </a>
            </li>
            <li class="nav-group-item ">
                <a href="//blog.saevon.ca/review/">
                    Review
                </a>
            </li>
            <li class="nav-group-item ">
                <a href="//blog.saevon.ca/roleplaying/">
                    Roleplaying
                </a>
            </li>
        </ul>
    </div>
    <div class="nav-link nav-link-single ">
        <a href="//blog.saevon.ca/tags/">
            <div class="nav-link-title">
                Tags
            </div>
        </a>
    </div>
</div>
<div class="clearfix"></div>

    <div class="sidenav-acc-links">
        <hr />
        <div class="account-links center">
                <a href="https://github.com/Saevon" class="account-link">
                    <i class="fa fa-github-square"></i>
                </a>
                <a href="https://ca.linkedin.com/in/saevon" class="account-link">
                    <i class="fa fa-linkedin-square"></i>
                </a>
        </div>
    </div>



<div class="sidenav-copyrights">
    <hr />
    <footer>
        <small class="center copyright">
            <a href="/license/">
                Â© Saevon 2015
            </a>
        </small>
        <small class="center">
            Powered by <a href="http://pelican.notmyidea.org/">Pelican</a>
        </small>
    </footer>
</div>

<hr class="visible-xs" />
<hr class="visible-xs" />
			</div>

		<!-- Content -->
		<section class="section-content col-md-9 col-sm-9 col-xs-12">
    <article class="article article-full">
<div class="page-header">

        <a href="//blog.saevon.ca/coding/webrtc-with-jssip-and-asterisk/" rel="bookmark" title="Permalink to WebRTC with JsSIP and Asterisk" class="perma-link">
            <h1>WebRTC with JsSIP and Asterisk                    <small class="tagline">Trying to get leading edge tech to work: WebRTC</small>
            </h1>
        </a>
</div>
        <div class="date">
          <span>04 July 2013</span>
        </div>
        <div class="content">
          <p>Recently I've been trying to get a web phone up and running, my only real requirement was to use Asterisk. So I decided to go with the following technology stack, JsSIP, Chrome and Asterisk.</p>
<section class="&quot;section section2&quot;" id="browsers"><h2>Browsers</h2>
<p>I've only tried to use chrome so far, though I've read that Firefox is currently WebRTC capable as well.</p>
<p>Chrome on OSX seems to work fine (version 27.0.1453.116).</p>
<p>Chrome on Ubuntu had problems until I updated to a <a href="http://www.ubuntuupdates.org/package/google_chrome/stable/main/base/google-chrome-beta">Beta version</a> (version 28.0.1500.52 beta)</p>
</section><section class="&quot;section section2&quot;" id="asterisk"><h2>Asterisk</h2>
<p>Asterisk had quite a few requirements before I could get it to work with WebRTC, <a href="https://wiki.asterisk.org/wiki/display/AST/Asterisk+WebRTC+Support" title="Asterisk and WebRTC">see this page for details</a>.</p>
<section class="&quot;section section4&quot;" id="building"><h4>Building</h4>
<p>You will likely need to rebuild Asterisk as WebRTC requires a SRTP libraries, which aren't included by default.</p>
<p>You will need the following libraries on the machine you use to recompile Asterisk:</p>
<ul>
<li>libssl-dev</li>
<li>libsrtp0</li>
</ul>
<p>Once you have these libraries installed, you will also need to enable two Asterisk resources:</p>
<ul>
<li>res_srtp.so</li>
<li>res_http_websocket.so</li>
</ul>
<p>Now you can recompile.</p>
<p>The resulting build might also need a few configuration changes:</p>
<div class="highlight"><pre><span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">asterisk</span><span class="o">/</span>
  <span class="o">|--</span> <span class="n">http</span><span class="p">.</span><span class="n">conf</span>
  <span class="o">|--</span> <span class="n">modules</span><span class="p">.</span><span class="n">conf</span>
  <span class="o">|--</span> <span class="n">sip</span><span class="p">.</span><span class="n">conf</span>
</pre></div>


<ul>
<li>
<p><code>http.conf</code>
    Ensure the following options are set</p>
<div class="highlight"><pre><span class="n">enabled</span><span class="o">=</span><span class="n">yes</span>
<span class="n">bindaddr</span><span class="o">=</span><span class="mf">0.0.0.0</span>
<span class="n">bindport</span><span class="o">=</span><span class="mi">8088</span>
</pre></div>


</li>
<li>
<p><code>modules.conf</code>
    you must load res_http_websocket.so before chan_sip.so</p>
</li>
<li>
<p><code>sip.conf</code>
    Any users that you want to allow WebRTC for you need:</p>
<div class="highlight"><pre><span class="n">encryption</span><span class="o">=</span><span class="n">yes</span>
<span class="n">avpf</span><span class="o">=</span><span class="n">yes</span>
<span class="n">transport</span><span class="o">=</span><span class="n">ws</span><span class="p">,</span><span class="n">wss</span>
<span class="n">icesupport</span><span class="o">=</span><span class="n">yes</span>
</pre></div>


<p>Adding <strong>encryption=yes</strong> to any non WebRTC phones might make them break, so be careful.</p>
</li>
</ul>
<p><div class="alert alert-info "><i class="fa fa-info-circle"></i>
    Remember to restart Asterisk once you're done.
</div></p>
</section></section><section class="&quot;section section2&quot;" id="jssip"><h2>JsSIP</h2>
<p>JsSIP <a href="http://jssip.net/" title="JsSip">JsSIP</a> was quite easy to use, however it wasn't without its set of problems. If you want to do a quick test yourself, check out the <a href="https://jssip.tryit.net" title="JsSip Tryit">JsSIP Tryit</a> page.</p>
<p>My main problem was that their script didn't seem to connect with asterisk properly, though I've already forgotten the reason (will update if I do). To solve this I updated to the dev version of JsSIP, which I download from the <a href="https://jssip.tryit.net" title="JsSip Tryit">JsSIP Tryit</a> page.</p>
<p>Afterwards I would also have jssip error out when I tried to type in an invalid target, I patched it quickly removing the potentially erroneous code. I didn't know enough about their side of the problem, so I have no way of knowing if this is a correct fix.</p>
<p><div class="alert alert-warning "><i class="fa fa-warning"></i>
    I've included the patch below, use it at your own risk.
</div></p>
<div class="highlight"><pre><span class="gh">Index: /static/js/jssip-devel.js</span>
<span class="gh">===================================================================</span>
<span class="gd">--- /static/js/jssip-devel.js</span>
<span class="gi">+++ /static/js/jssip-devel.js</span>
<span class="gu">@@ -3372,5 +3372,10 @@</span>
         console.log(LOG_PREFIX +&#39;ICE candidate received: &#39;+ e.candidate.candidate);
       } else {
<span class="gd">-        self.onIceCompleted();</span>
<span class="gi">+       // PATCH: (saevon) Fixes bug with the code crashing at this step.</span>
<span class="gi">+       // since: neither createOffer nor createAnswer get called if you</span>
<span class="gi">+       // had an &quot;Invalid Target&quot;</span>
<span class="gi">+       // Thus the method doesn&#39;t get added yet</span>
<span class="gi">+       if (self.onIceCompleted) {</span>
<span class="gi">+           self.onIceCompleted();</span>
<span class="gi">+       }</span>
       }
     };
</pre></div>


</section><section class="&quot;section section2&quot;" id="conclusion"><h2>Conclusion</h2>
<p>WebRTC is clearly still a work in progress, and I hope it gets polished up nicely for when I next wish to use it.</p>
<hr />
</section><section class="&quot;section section2&quot;" id="reference"><h2>Reference</h2>
<ul>
<li><a href="http://jssip.net/" title="JsSip">JsSIP</a></li>
<li><a href="https://jssip.tryit.net" title="JsSip Tryit">JsSip Tryit</a></li>
<li><a href="https://wiki.asterisk.org/wiki/display/AST/Asterisk+WebRTC+Support" title="Asterisk and WebRTC">Asterisk and WebRTC</a></li>
</ul>
</section>
        </div>

        <hr />

    <ul class="tag-box">
      <li><i class="fa fa-tags"> </i></li>
      <li>
        <a href="//blog.saevon.ca/coding/" class="tag-box-item">
          category: coding
            <span class="tag-count">4</span>
        </a>
      </li>
        <li>
          <a href="//blog.saevon.ca/tags/asterisk/" class="tag-box-item">asterisk<span class="tag-count">1</span>
          </a>
        </li>
        <li>
          <a href="//blog.saevon.ca/tags/javascript/" class="tag-box-item">javascript<span class="tag-count">1</span>
          </a>
        </li>
        <li>
          <a href="//blog.saevon.ca/tags/jssip/" class="tag-box-item">jssip<span class="tag-count">1</span>
          </a>
        </li>
        <li>
          <a href="//blog.saevon.ca/tags/webrtc/" class="tag-box-item">webrtc<span class="tag-count">1</span>
          </a>
        </li>
    </ul>

            <hr />
    </article>

        <footer>
            <a href="//blog.saevon.ca/coding/">&larr; Back to coding</a>
        </footer>

        <hr />

        <div id="comments">
<div id="disqus_thread"></div>

<script type="text/javascript" id="disqus-config">
    var disqus_shortname = 'blog-saevon';

    var disqus_identifier = 'webrtc-with-jssip-and-asterisk';
    var disqus_title = 'WebRTC with JsSIP and Asterisk';

        var disqus_url = window.location.protocol + '//blog.saevon.ca/coding/webrtc-with-jssip-and-asterisk/';
</script>

<script type="text/javascript" async src="//blog-saevon.disqus.com/embed.js"></script>

<a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>

                <noscript>Please enable JavaScript to view the comments</noscript>
        </div>
		</section>
	</div></div>

</body>
</html>